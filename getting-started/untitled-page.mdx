---
title: "untitled-page"
---

```typescript
import { NextRequest, NextResponse } from 'next/server';

/**
 * <summary>
 * The function POST processes a request by utilizing the OpenAI API to generate AI suggestions based
 * on user input.
 * </summary>
 * <param name="request">The `request` parameter in the `POST` function represents the incoming HTTP
 * request made to the server. In this case, it is a request object of type `NextRequest`, which likely
 * contains information about the request such as headers, body content, and other relevant details.
 * The function is designed to</param>
 * <returns>
 * The function `POST` is returning a JSON response object with the properties `suggestions` and
 * `isAiGenerated`. The `suggestions` property contains either default suggestions or AI-generated
 * suggestions based on the input data, and the `isAiGenerated` property indicates whether the
 * suggestions were generated by an AI model or not.
 * </returns>
 */
export async function POST(request: NextRequest) {
  let body: any;
  try {
    body = await request.json();
    const { type, context } = body;

    if (!process.env.OPENAI_API_KEY) {
      return NextResponse.json({
        suggestions: getDefaultSuggestions(type, context),
        isAiGenerated: false,
      });
    }

    const response = await fetch('https://api.openai.com/v1/chat/completions', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
        Authorization: `Bearer ${process.env.OPENAI_API_KEY}`,
      },
      body: JSON.stringify({
        model: 'gpt-3.5-turbo',
        messages: [
          {
            role: 'system',
            content: 'You are a helpful assistant for meeting planning.',
          },
          {
            role: 'user',
            content: generatePrompt(type, context),
          },
        ],
        temperature: 0.7,
        max_tokens: 500,
      }),
    });

    if (!response.ok) {
      throw new Error('OpenAI API request failed');
    }

    const data = await response.json();
    const suggestions = parseSuggestions(data.choices[0].message.content, type);

    return NextResponse.json({ suggestions, isAiGenerated: true });
  } catch (error) {
    console.error('Error generating AI suggestions:', error);
    return NextResponse.json({
      suggestions: getDefaultSuggestions(body?.type || '', body?.context || {}),
      isAiGenerated: false,
    });
  }
}

/**
 * <summary>
 * The function `generatePrompt` takes a type and context as input and returns a prompt message based
 * on the type, providing specific instructions for different scenarios.
 * </summary>
 * <param name="type">The `type` parameter specifies the type of prompt you want to generate. It can
 * have values like 'dates', 'locations', 'best-option', or 'invitation'.</param>
 * <param name="context">The `context` parameter is an object that contains information relevant to the
 * prompt being generated. It could include details such as the title, description, votes, or link
 * related to a meeting. The function `generatePrompt` uses this context to create specific prompts
 * based on the type of prompt requested.</param>
 * <returns>
 * The function `generatePrompt` returns a prompt or message based on the `type` and `context` provided
 * as parameters. The prompt varies depending on the `type` of prompt requested, such as dates,
 * locations, best option, or invitation. The returned prompt is a string containing specific
 * instructions or information tailored to the given `type` and `context`.
 * </returns>
 */
function generatePrompt(type: string, context: any): string {
  if (type === 'dates') {
    return `Suggest 3 good meeting dates for the next 2 weeks. Consider that the meeting is about: "${context.title}". Return only a JSON array of ISO datetime strings.`;
  } else if (type === 'locations') {
    return `Suggest 3 good meeting locations for: "${context.title}". Consider the context: "${context.description}". Return only a JSON array of location names as strings.`;
  } else if (type === 'best-option') {
    return `Based on these votes: ${JSON.stringify(context.votes)}, suggest the best meeting time and location. Consider 'yes' votes as 3 points, 'maybe' as 1 point, and 'no' as 0 points. Return a brief recommendation in Polish.`;
  } else if (type === 'invitation') {
    return `Generate a friendly invitation message in Polish for a meeting titled "${context.title}" with description "${context.description}". Include the link: ${context.link}. Keep it concise and professional.`;
  }
  return '';
}

/**
 * <summary>
 * The function `parseSuggestions` attempts to extract and parse JSON suggestions from a string and
 * returns default suggestions if parsing fails.
 * </summary>
 * <param name="content">The `content` parameter is a string that likely contains JSON data
 * representing suggestions from an AI response. The function attempts to extract and parse this JSON
 * data to retrieve the suggestions. If parsing fails, it will log an error and return default
 * suggestions based on the `type` parameter.</param>
 * <param name="type">The `type` parameter is a string that specifies the type of suggestions being
 * parsed.</param>
 * <returns>
 * The function `parseSuggestions` will return the parsed JSON content if it is found in the input
 * `content`, otherwise it will return the default suggestions obtained from the
 * `getDefaultSuggestions` function.
 * </returns>
 */
function parseSuggestions(content: string, type: string): any {
  try {
    const jsonMatch = content.match(/\[.*\]/s);
    if (jsonMatch) {
      return JSON.parse(jsonMatch[0]);
    }
  } catch (e) {
    console.error('Failed to parse AI response:', e);
  }
  return getDefaultSuggestions(type, {});
}

/**
 * <summary>
 * The function `getDefaultSuggestions` returns default suggestions based on the type provided, such as
 * dates, locations, best options, or invitations for a meeting.
 * </summary>
 * <param name="type">The `type` parameter in the `getDefaultSuggestions` function is used to determine
 * the type of suggestions to generate. The function provides different default suggestions based on
 * the value of the `type` parameter. The possible values for `type` in this function are 'dates',
 * 'locations', 'best-option</param>
 * <param name="context">The `context` parameter in the `getDefaultSuggestions` function is an object
 * that contains information relevant to the type of suggestions being generated. It could include
 * details such as the title of the event for which suggestions are being made and a link for
 * participants to vote on their preferred options.</param>
 * <returns>
 * The `getDefaultSuggestions` function returns different suggestions based on the `type` parameter
 * provided. Here is what is being returned for each `type`:
 * </returns>
 */
function getDefaultSuggestions(type: string, context: any): any {
  if (type === 'dates') {
    const suggestions = [];
    const now = new Date();
    for (let i = 1; i <= 3; i++) {
      const date = new Date(now);
      date.setDate(date.getDate() + i * 3);
      date.setHours(14, 0, 0, 0);
      suggestions.push(date.toISOString());
    }
    return suggestions;
  } else if (type === 'locations') {
    return ['Kawiarnia w centrum', 'Sala konferencyjna', 'Online (Zoom/Meet)'];
  } else if (type === 'best-option') {
    return 'Na podstawie głosów, zalecamy wybranie opcji z największą liczbą głosów "Tak".';
  } else if (type === 'invitation') {
    return `Witaj! Zapraszam Cię do udziału w planowaniu spotkania "${context.title}". Kliknij w link i zagłosuj na swoje preferowane terminy i lokalizacje: ${context.link}`;
  }
  return [];
}
```